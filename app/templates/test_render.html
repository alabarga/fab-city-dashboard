

{% extends "load_data.html" %}
	
	
	{% if map_ %}
		
		{% block map_ %}
			
			
			<!-- DIV MAP -->
			<div id="map" style="width: 100%; height: 500px"></div>
		
			
			<!-- LEAFLET TEST DATAS -->
			<script src="{{ url_for('static', filename='data_custom/Leaflet_sample-geojson.js') }}" type="text/javascript"></script>
			<script src="{{ url_for('static', filename='data_custom/FablabsIO_fablabs.json') }}" type="text/javascript"></script>
			<script src="{{ url_for('static', filename='data_custom/Makery_fablabs.json') }}" type="text/javascript"></script>
			
			
			<!-- LEAFLET SCRIPT -->
			<script>
				
				// CREATE EMPTY LAYER
				var empty_layer = new L.layerGroup();
				
				// CREATE EMPTY LAYER
				var fablabs_layer = new L.layerGroup();
				
				// CLUSTERS
				//var markerClusters = new L.MarkerClusterGroup();
				
				// BASEMAP
				var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
						'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
						'Imagery <a href="http://mapbox.com">Mapbox</a>';
				var mbUrl  = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw';

				var grayscale  = L.tileLayer(mbUrl, {id: 'mapbox.light'  , attribution: mbAttr});
				var streets    = L.tileLayer(mbUrl, {id: 'mapbox.streets', attribution: mbAttr});


				var map = L.map('map', {
					center: [20, 0],
					zoom: 2,
					layers: [grayscale, fablabs_layer]
				});
				
				//var map = L.map('map')
				//	.setView([20, 0], 2)
				//	.layers: [empty_layer, fablabs_layer]
				//	;
					
				//L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
				//	maxZoom: 18,
				//	attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				//		'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				//		'Imagery <a href="http://mapbox.com">Mapbox</a>',
				//	id: 'mapbox.light'
				//}).addTo(map);
		
		
				// FUNCTION - ADD POPUP TO FEATURES
				function onEachFeature(feature, layer) {
					var popupContent = "<p> GeoJSON geom type : " +	feature.geometry.type + "</p>";
					if (feature.properties && feature.properties.name) {
						popupContent += "FABALAB : "+feature.properties.name;
					}
					layer.bindPopup(popupContent);
				}
				
				// LOAD FABLABS
				var Fablabs = L.geoJson([M_fablabs]	, {
					
					style: function (feature) {
						return feature.properties && feature.properties.style;
					},
					
					onEachFeature: onEachFeature,
					
					pointToLayer: function (feature, latlng) {
						return L.circleMarker(latlng, {
							radius: 3,
							fillColor: "#ff7800",
							color: "#000",
							weight: 1,
							opacity: 1,
							fillOpacity: 0.8
						});
					}
					
				})
				.addTo(map)
				.addTo(fablabs_layer);
				
				//markerClusters.addLayer(Fablabs);
				//map.addLayer(markerClusters);
				
				// CLUSTERS 2 // cf too : https://medium.com/@SamCorcos/building-campaignhawk-clustering-with-leaflet-markercluster-part-17-3b79ee168342#.3wmct7b07
				//for ( var i = 0; i < M_fablabs.features.length; ++i )
				//	{ var M_Fab = M_fablabs.features ;
				//	  var popup = M_fab[i].name +
				//				  '<br/> / ' + M_Fab[i].city +
				//				  '<br/><b>country :</b> ' + M_Fab[i].country +
				//				  '<br/><b>type :</b> ' + M_Fab[i].type_lab +
				//				  '<br/><b>adress :</b> ' + M_Fab[i].adress +
				//				  '<br/><b>website :</b> ' + M_Fab[i].website;
				//	
				//	  var m = L.marker( [M_fablabs[i].lat, M_Fab[i].lng], {icon: myIcon} )
				//					  .bindPopup( popup );
				//	
				//	  markerClusters.addLayer( m );
				//	}
				
				// CREATE CONTROLS
				var baseLayers = {
					"Grayscale": grayscale,
					"Streets"  : streets
				};
				
				var overlays = {
					"Empty layer" : empty_layer,
					"Fablabs"     : fablabs_layer
				};
				
				var controls = L.control.layers(baseLayers, overlays).addTo(map);

		
		
		
		
			</script>
		
		
		{% endblock %}
	
	{% endif %} <!-- end leaflet call -->
